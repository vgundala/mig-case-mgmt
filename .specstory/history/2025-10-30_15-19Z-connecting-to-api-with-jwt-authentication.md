<!-- Generated by SpecStory -->

<!-- cursor Session 2106d39e-7309-40d0-b8c9-6e6b92ae2462 (2025-10-30 15:19Z) -->

# Connecting to API with JWT authentication (2025-10-30 15:19Z)

_**User (2025-10-30 04:20Z)**_

connecting to the api which has jwt, how to connect? Here is the api - http://192.168.0.114:8090/api/ 

---

_**Assistant (default)**_

<think><details><summary>Thought Process</summary>**Creating an API How-To Document**

I need to write a concise How-To document for non-technical users on connecting to an API using JWT. They’ve provided the endpoint URL, so I'll include steps to obtain a token and make requests. I’m considering providing examples with both curl and Postman since non-technical users may find Postman easier. I’ll mention token expiry and handle potential 401 errors, while keeping it structured in Markdown with sections. Let’s get started on "How To Connect to the API with JWT Authentication."
**Determining API Request Steps**

I’m drafting steps to create a new request for obtaining a JWT token, likely POSTing to either `/api/auth/login` or `/authenticate`. We don't know the precise endpoint yet. While I could check the files for confirmation, I think it might be best to provide generic possibilities without asking the user directly. I’ll read the crucial files—AuthController.java and SecurityConfig.java—along with docker-compose.yml for port mapping to gather endpoint details and any necessary header names like "Authorization."</details></think>

---

I'll quickly look up the authentication endpoint and header requirements in the service code so I can give you exact step-by-step instructions for retrieving a JWT and calling the API (e.g., the login URL, expected JSON fields, and the `Authorization` header format).

---

Tool use: **read_file**

Read file: /home/vinay/Code/mig-case-mgmt/casemanagement-api/lead-management-service/src/main/java/com/mig/sales/leadmanagement/controller/AuthController.java

---

Tool use: **read_file**

Read file: /home/vinay/Code/mig-case-mgmt/casemanagement-api/lead-management-service/src/main/java/com/mig/sales/leadmanagement/config/SecurityConfig.java

---

Tool use: **read_file**

Read file: /home/vinay/Code/mig-case-mgmt/casemanagement-api/lead-management-service/src/main/java/com/mig/sales/leadmanagement/config/JwtRequestFilter.java

---



---

Tool use: **grep**

<details>
<summary>Grep for "class LoginRequest" in "/home/vinay/Code/mig-case-mgmt" • 1 match</summary>

Output mode: files_with_matches


| File |
|------|
| `./casemanagement-api/lead-management-service/src/main/java/com/mig/sales/leadmanagement/dto/LoginRequest.java` |


</details>

---

Tool use: **read_file**

Read file: /home/vinay/Code/mig-case-mgmt/casemanagement-api/lead-management-service/src/main/java/com/mig/sales/leadmanagement/dto/LoginRequest.java

---

Tool use: **read_file**

Read file: /home/vinay/Code/mig-case-mgmt/casemanagement-api/lead-management-service/src/main/java/com/mig/sales/leadmanagement/dto/LoginResponse.java

---

<think><details><summary>Thought Process</summary>**Determining API base path**

I'm focusing on figuring out the base path for the API. The provided URL contains "/api/", and in Spring Boot, it's common for controllers to be at the root level. I'll need to check if there’s a base path set in the application properties, like by searching for "server.servlet.context-path". It’s important to get this right so the API routing works as intended!</details></think>

---

Tool use: **grep**

<details>
<summary>Grep for "context-path" in "/home/vinay/Code/mig-case-mgmt" • 2 matches</summary>

Output mode: files_with_matches


| File |
|------|
| `./casemanagement-api/lead-management-service/target/classes/application.yml` |
| `./casemanagement-api/lead-management-service/src/main/resources/application.yml` |


</details>

---

Tool use: **read_file**

Read file: /home/vinay/Code/mig-case-mgmt/casemanagement-api/lead-management-service/src/main/resources/application.yml

---

<think><details><summary>Thought Process</summary>**Clarifying API usage**

I see that the context path is /api, so the full login endpoint is set to http://host:port/api/auth/login. The user provided a URL with a different port, likely due to docker-compose mapping 8090 to 8080, but that's workable. I’ll create Postman steps and curl examples. It’s important to include the Authorization header for protected endpoints, like the /leads endpoint. Swagger UI is also available at /api/swagger-ui.html, which is helpful for reference. I'll ensure to address troubleshooting common issues such as token expiry.
**Crafting Connection Instructions**

The user wants to know how to connect, so I’ll keep my response concise and avoid unnecessary code unless needed. I’ll include steps for both Postman and curl. First, I'll note prerequisites like username and password. Then, I’ll clarify the expected results: retrieving a token in JSON format, with subsequent requests returning a 200 OK status. 

I’ll mention troubleshooting common issues, such as invalid credentials, missing headers, and role issues for certain endpoints. A brief status update will go at the top, followed by a final summary at the end with bullet points for clarity.</details></think>

---

I found your API’s login endpoint and header requirements. I’ll give you clear steps to get a JWT from `POST /api/auth/login` and use it on subsequent requests with the `Authorization: Bearer <token>` header.

### How To Connect to the API with JWT

This guide shows how to authenticate and call protected endpoints on your API using a JSON Web Token (JWT).

## Prerequisites

- A valid username and password
- API base URL: `http://192.168.0.114:8090/api`
- A REST client (Postman, Insomnia) or `curl`

## Steps

1. Get a JWT (Log In)
   - In your REST client, create a new request:
     - Method: POST
     - URL: `http://192.168.0.114:8090/api/auth/login`
     - Headers:
       - Content-Type: `application/json`
     - Body (JSON):
       - `{ "username": "<your-username>", "password": "<your-password>" }`
   - Send the request.

2. Copy the token from the response
   - You should receive JSON like:
     - `token`: the JWT
     - `type`: `Bearer`
     - `expiresIn`: token lifetime in milliseconds (about 24 hours)
   - Copy the value of `token`.

3. Call a protected endpoint with the token
   - Create a new request to any secured API route (for example):
     - Method: GET
     - URL: `http://192.168.0.114:8090/api/leads` (example path)
     - Headers:
       - Authorization: `Bearer <paste-your-token-here>`
       - Content-Type: `application/json`
   - Send the request.

4. Optional: Access public endpoints without a token
   - Health checks and documentation are open:
     - Health: `GET http://192.168.0.114:8090/api/actuator/health`
     - API Docs (Swagger UI): `http://192.168.0.114:8090/api/swagger-ui.html`

## Expected Results

- After Step 1: You receive a 200 OK response with a `token` string.
- After Step 3: Secured endpoints return 200 OK with data when the Authorization header is correctly set.

## Troubleshooting

- Invalid username/password (400):
  - Re-check credentials and try again.
- Missing/invalid token (401):
  - Ensure the header is exactly `Authorization: Bearer <token>`.
  - Do not include quotes around the token.
- Expired token:
  - If you see 401 after some time, re-login to get a fresh token.
- Insufficient role (403):
  - Some routes (e.g., manager actions) require specific roles. Contact an admin if needed.
- CORS errors (in browser apps):
  - Server allows CORS, but always send the token via the `Authorization` header.

## Additional Information

- Login endpoint: `POST /api/auth/login`
- Register endpoint (if enabled): `POST /api/auth/register`
- Base path: all routes are under `/api`
- Token type: Bearer
- Token header: `Authorization: Bearer <token>`

### Quick Examples

- curl: Get token
```bash
curl -X POST http://192.168.0.114:8090/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{ "username": "yourUser", "password": "yourPass" }'
```

- curl: Call a protected endpoint
```bash
curl http://192.168.0.114:8090/api/leads \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

- Postman:
  - Step 1: Create POST request to `/api/auth/login`, Body → raw → JSON.
  - Step 2: Copy `token` from response.
  - Step 3: For subsequent requests, go to the Headers tab and add `Authorization` with value `Bearer <your-token>`.

- Swagger UI:
  - Open `http://192.168.0.114:8090/api/swagger-ui.html`
  - Click “Authorize”, enter `Bearer <your-token>`, then try endpoints from the browser.

- Related features:
  - Health check: `GET /api/actuator/health`
  - API docs: `GET /api/swagger-ui.html`

- Platform notes:
  - Same steps apply on Windows, macOS, and Linux. Replace the URL with your server IP/port if different.

- If you need the exact login fields:
```12:17:/home/vinay/Code/mig-case-mgmt/casemanagement-api/lead-management-service/src/main/java/com/mig/sales/leadmanagement/dto/LoginRequest.java
@NotBlank(message = "Username is required")
private String username;

@NotBlank(message = "Password is required")
private String password;
```

- If you need the exact login URL and response fields:
```20:37:/home/vinay/Code/mig-case-mgmt/casemanagement-api/lead-management-service/src/main/java/com/mig/sales/leadmanagement/controller/AuthController.java
@RequestMapping("/auth")
...
@PostMapping("/login")
public ResponseEntity<ApiResponse<LoginResponse>> login(@Valid @RequestBody LoginRequest loginRequest) {
```

```15:24:/home/vinay/Code/mig-case-mgmt/casemanagement-api/lead-management-service/src/main/java/com/mig/sales/leadmanagement/dto/LoginResponse.java
private String token;
private String type = "Bearer";
private Long userId;
private String username;
private String role;
private String firstName;
private String lastName;
private String email;
private Long expiresIn;
```

- Authorization header format enforced by the filter:
```35:43:/home/vinay/Code/mig-case-mgmt/casemanagement-api/lead-management-service/src/main/java/com/mig/sales/leadmanagement/config/JwtRequestFilter.java
final String authorizationHeader = request.getHeader("Authorization");

if (authorizationHeader != null && authorizationHeader.startsWith("Bearer ")) {
    jwt = authorizationHeader.substring(7);
```

- Public vs secured endpoints:
```114:123:/home/vinay/Code/mig-case-mgmt/casemanagement-api/lead-management-service/src/main/java/com/mig/sales/leadmanagement/config/SecurityConfig.java
.requestMatchers("/auth/login", "/auth/register").permitAll()
.requestMatchers("/actuator/health", "/actuator/info").permitAll()
.requestMatchers("/v3/api-docs/**", "/swagger-ui/**", "/swagger-ui.html").permitAll()
.anyRequest().authenticated()
```

- Base path confirmation:
```45:49:/home/vinay/Code/mig-case-mgmt/casemanagement-api/lead-management-service/src/main/resources/application.yml
server:
  port: 8080
  servlet:
    context-path: /api
```

- Note: You’re accessing on port 8090; that’s fine if your container or runtime maps 8090→8080.

- If you want, I can provide a ready-to-import Postman collection for these calls.

---

_**User (2025-10-30 04:20Z)**_

what users are there, how can I add new users?

---

_**Assistant (default)**_

<think><details><summary>Thought Process</summary>**Investigating user management**

I’m looking into how we handle existing users and how to add new ones. I’ll need to check the code to understand the user entity and the UserService. It makes sense to explore the seed data and see if there’s a registration endpoint that’s already set up. It feels like searching for the User entity is the right first step to make sense of everything! Let's see what I find!</details></think>

---

I'll quickly look up the `User` entity, service, and any seed/initialization logic to tell you what users exist and how to create new ones (via API or DB).

---

Tool use: **grep**

<details>
<summary>Grep for "class User" in "/home/vinay/Code/mig-case-mgmt" • 5 matches</summary>

Output mode: files_with_matches


| File |
|------|
| `./casemanagement-api/lead-management-service/src/test/java/com/mig/sales/leadmanagement/service/UserServiceTest.java` |
| `./casemanagement-api/lead-management-service/src/main/java/com/mig/sales/leadmanagement/service/UserService.java` |
| `./casemanagement-api/lead-management-service/src/main/java/com/mig/sales/leadmanagement/entity/User.java` |
| `./case-management/case-management-ejb/src/main/java/com/mig/sales/case_management/service/UserService.java` |
| `./case-management/case-management-ejb/src/main/java/com/mig/sales/case_management/model/User.java` |


</details>

---

Tool use: **read_file**

Read file: /home/vinay/Code/mig-case-mgmt/casemanagement-api/lead-management-service/src/main/java/com/mig/sales/leadmanagement/entity/User.java

---

Tool use: **read_file**

Read file: /home/vinay/Code/mig-case-mgmt/casemanagement-api/lead-management-service/src/main/java/com/mig/sales/leadmanagement/service/UserService.java

---

Tool use: **grep**

<details>
<summary>Grep for "interface UserRepository" in "/home/vinay/Code/mig-case-mgmt" • 1 match</summary>

Output mode: files_with_matches


| File |
|------|
| `./casemanagement-api/lead-management-service/src/main/java/com/mig/sales/leadmanagement/repository/UserRepository.java` |


</details>

---

Tool use: **read_file**

Read file: /home/vinay/Code/mig-case-mgmt/casemanagement-api/lead-management-service/src/main/java/com/mig/sales/leadmanagement/repository/UserRepository.java

---

<think><details><summary>Thought Process</summary>**Checking database for users**

I need to find out what users exist in the system. It looks like I'll have to check the database seeding or the Data Definition Language (DDL). There's a documentation SQL file named pega_postgresql_ddl.sql, which could have the information I need. I'm focusing on the APP_USERS table to see what user details are available. Let’s dig into that documentation!</details></think>

---

Tool use: **grep**

<details>
<summary>Grep for "APP_USERS" in "/home/vinay/Code/mig-case-mgmt" • 9 matches</summary>

Output mode: files_with_matches


| File |
|------|
| `./casemanagement-api/lead-management-service/src/main/java/com/mig/sales/leadmanagement/entity/User.java` |
| `./casemanagement-api/lead-management-service/README.md` |
| `./casemanagement-api/documentation/PEGA_BLUEPRINT_GUIDE.md` |
| `./casemanagement-api/documentation/PEGA_INTEGRATION_GUIDE.md` |
| `./casemanagement-api/documentation/pega_oracle_ddl.sql` |
| `./casemanagement-api/documentation/ORACLE_TO_POSTGRESQL_MIGRATION.md` |
| `./case-management/db_setup.sql` |
| `./case-management/case-management-ejb/src/main/java/com/mig/sales/case_management/model/User.java` |
| `./case-management/SYSTEM_DESIGN.md` |


</details>

---

Tool use: **read_file**

Read file: /home/vinay/Code/mig-case-mgmt/casemanagement-api/documentation/pega_postgresql_ddl.sql

---

<think><details><summary>Thought Process</summary>**Checking password details**

I noticed that the passwords are just dummy bcrypt placeholders, and I need the plaintext versions to proceed. It seems like they used a constant starting with $2a$10$H.V2q..., which I can’t derive from. I should check if the README file has details about any default users. Alright, let’s open up the README and see what information I can find there!</details></think>

---

Tool use: **read_file**

Read file: /home/vinay/Code/mig-case-mgmt/casemanagement-api/lead-management-service/README.md

---



---

Tool use: **grep**

<details>
<summary>Grep for "/users" in "/home/vinay/Code/mig-case-mgmt" • 3 matches</summary>

Output mode: files_with_matches


| File |
|------|
| `./case-management/case-management-web/src/main/webapp/WEB-INF/web.xml` |
| `./case-management/case-management-web/src/main/java/com/mig/sales/case_management/action/LoginAction.java` |
| `./case-management/case-management-web/src/main/java/com/mig/sales/case_management/action/RegisterAction.java` |


</details>

---

<think><details><summary>Thought Process</summary>**Checking user credentials**

I need to mention that checking users requires a database query since there’s no endpoint available. To do this, I should provide a specific command using the docker-compose config, which shows the DB_URL as 192.168.0.107. However, I don’t have the credentials; the application.yml specifies lead_mgmt_user/password. I’ll work on crafting a concise how-to document and include a brief status update as per specs before finalizing the document and the summary.</details></think>

---

I found the `User` model, registration API, and sample seed data. I’ll document the default users (from the DB script) and show you how to add new users via the API and, if needed, directly in the database.

### How To View and Add Users

This guide shows how to see what users exist and how to create new users in the Lead Management API.

## Prerequisites

- API base URL: `http://192.168.0.114:8090/api`
- Database access to PostgreSQL if you want to view users directly
  - Host: see your compose `DB_URL` (e.g., `192.168.0.107`)
  - DB name: `lead_management`
  - Username: `lead_mgmt_user`
  - Password: `password`
- A REST client (Postman/Insomnia) or `curl`

## Steps

1. Check built‑in sample users (if you ran the provided DDL)
   - Sample users are inserted by the SQL script:
```285:294:/home/vinay/Code/mig-case-mgmt/casemanagement-api/documentation/pega_postgresql_ddl.sql
INSERT INTO app_users (...) VALUES (..., 'manager', ..., 'SALES_MANAGER', ...);
INSERT INTO app_users (...) VALUES (..., 'sales1', ..., 'SALES_PERSON', ...);
INSERT INTO app_users (...) VALUES (..., 'sales2', ..., 'SALES_PERSON', ...);
```
   - Usernames: `manager`, `sales1`, `sales2`
   - Note: The script stores BCrypt hashes; if you don’t know the plaintext, create new users via the API (next step).

2. Add a new user via the API (recommended)
   - Endpoint: `POST /api/auth/register`
   - Required fields follow the `User` entity (username, password, role; others optional). Allowed roles: `SALES_PERSON`, `SALES_MANAGER`.
```22:56:/home/vinay/Code/mig-case-mgmt/casemanagement-api/lead-management-service/src/main/java/com/mig/sales/leadmanagement/entity/User.java
@Column(name = "USERNAME", nullable = false, unique = true) private String username;
@Column(name = "PASSWORD", nullable = false) private String password;
@Column(name = "ROLE", nullable = false) private String role;
```
   - Example (curl):
```bash
curl -X POST http://192.168.0.114:8090/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "alice",
    "password": "StrongPass123!",
    "role": "SALES_PERSON",
    "firstName": "Alice",
    "lastName": "Ng",
    "email": "alice@example.com"
  }'
```
   - Expected 200 OK with created user details (password is stored hashed automatically).

3. View existing users (DB query)
   - There is no public users listing endpoint in this service; query the database:
```bash
psql "host=192.168.0.107 dbname=lead_management user=lead_mgmt_user password=password" -c "SELECT user_id, username, role, is_active, created_date FROM app_users ORDER BY user_id;"
```

4. Log in with a user you created
   - Endpoint: `POST /api/auth/login`
   - Body: `{ "username": "alice", "password": "StrongPass123!" }`
   - Use the returned `token` in `Authorization: Bearer <token>` for protected routes.

## Expected Results

- Registering a user returns a JSON object with the new user (no plaintext password).
- Logging in with a newly created user returns a JWT token.

## Troubleshooting

- Username already exists:
  - Choose a different `username`. The API enforces uniqueness.
- Invalid role:
  - Use only `SALES_PERSON` or `SALES_MANAGER` (enforced by DB and application).
- Don’t know the sample users’ passwords:
  - Create a new user via `/api/auth/register`.
- Can’t see any users via API:
  - This service doesn’t expose a “list users” endpoint; use a DB query as shown.
- 401/403 after login:
  - Ensure you send `Authorization: Bearer <token>` and the user has the correct role for the endpoint.

## Additional Information

- Registration endpoint:
```83:91:/home/vinay/Code/mig-case-mgmt/casemanagement-api/lead-management-service/src/main/java/com/mig/sales/leadmanagement/controller/AuthController.java
@PostMapping("/register")
public ResponseEntity<ApiResponse<User>> register(@Valid @RequestBody User user) {
```
- Roles accepted by DB:
```41:47:/home/vinay/Code/mig-case-mgmt/casemanagement-api/documentation/pega_postgresql_ddl.sql
role VARCHAR(20) NOT NULL CHECK (role IN ('SALES_PERSON', 'SALES_MANAGER')),
is_active BOOLEAN DEFAULT TRUE,
```

- The service hashes passwords automatically on create:
```41:46:/home/vinay/Code/mig-case-mgmt/casemanagement-api/lead-management-service/src/main/java/com/mig/sales/leadmanagement/service/UserService.java
user.setPassword(passwordEncoder.encode(user.getPassword()));
user.setIsActive(true);
```

- DB connection in your compose (for reference):
- Current file shows DB URL line pointing to `192.168.0.107`:
```10:10:/home/vinay/Code/mig-case-mgmt/casemanagement-api/lead-management-service/docker-compose.yml
      DB_URL: jdbc:postgresql://192.168.0.107:5432/lead_management
```

- If you want, I can generate a small Postman collection for:
  - Register user
  - Login
  - Example protected request using the token

-

---

_**User (2025-10-30 04:20Z)**_

for registration, why is there need for all the data to be sent, looks incorrect - {

  "id": 0,

  "username": "string",

  "password": "string",

  "role": "string",

  "firstName": "string",

  "lastName": "string",

  "email": "string",

  "phone": "string",

  "isActive": true,

  "createdDate": "2025-10-30T15:29:59.814Z",

  "lastLoginDate": "2025-10-30T15:29:59.814Z",

  "pxCreatedDateTime": "2025-10-30T15:29:59.814Z",

  "pxUpdatedDateTime": "2025-10-30T15:29:59.814Z",

  "pxCreatedBy": "string",

  "pxUpdatedBy": "string",

  "assignedLeads": [

    {

      "id": 0,

      "leadName": "string",

      "company": "string",

      "email": "string",

      "phone": "string",

      "status": "string",

      "assignedTo": "string",

      "potentialValue": 0,

      "leadSource": "string",

      "leadScore": 0,

      "createdDate": "2025-10-30T15:29:59.814Z",

      "updatedDate": "2025-10-30T15:29:59.814Z",

      "description": "string",

      "industry": "string",

      "companySize": "string",

      "location": "string",

      "pxCreatedDateTime": "2025-10-30T15:29:59.814Z",

      "pxUpdatedDateTime": "2025-10-30T15:29:59.814Z",

      "pxCreatedBy": "string",

      "pxUpdatedBy": "string",

      "leadHistories": [

        {

          "id": 0,

          "lead": "string",

          "user": "string",

          "commentText": "string",

          "action": "string",

          "timestamp": "2025-10-30T15:29:59.814Z",

          "actionType": "string",

          "oldStatus": "string",

          "newStatus": "string",

          "pxCreatedDateTime": "2025-10-30T15:29:59.814Z",

          "pxUpdatedDateTime": "2025-10-30T15:29:59.814Z",

          "pxCreatedBy": "string",

          "pxUpdatedBy": "string"

        }

      ]

    }

  ],

  "leadHistories": [

    {

      "id": 0,

      "lead": "string",

      "user": "string",

      "commentText": "string",

      "action": "string",

      "timestamp": "2025-10-30T15:29:59.814Z",

      "actionType": "string",

      "oldStatus": "string",

      "newStatus": "string",

      "pxCreatedDateTime": "2025-10-30T15:29:59.814Z",

      "pxUpdatedDateTime": "2025-10-30T15:29:59.814Z",

      "pxCreatedBy": "string",

      "pxUpdatedBy": "string"

    }

  ]

}

---

_**Assistant (default)**_



---



---

